<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Scraping Makes You Feel Like a Small God</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/assets/base.css">
        <link rel="stylesheet" href="/assets/syntax.css">

        <!-- Custom CSS -->
        <!-- <link rel="stylesheet" href="/assets/main.css"> -->

        <script src="/assets/d3.v3.min.js" charset="utf-8"></script>
        <script src="/assets/topojson.v1.min.js" charset="utf-8"></script>
        <script src="/assets/queue.v1.min.js" charset="utf-8"></script>
    </head>
    <body>
        <div class="main">

            <header>
  <a href="/">NYU — Spring 2015</a> / <span>Week 6</span>
</header>

<h1>Scraping Makes You Feel Like a Small God</h1>

<div class="lesson">
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>

<h2>Housekeeping</h2>

<p>Questions?</p>

<h2>Ruby</h2>

<p>Do you have it? Check by typing &ldquo;ruby&rdquo; at your terminal. If you get something like &ldquo;command not found&rdquo;, <a href="https://www.ruby-lang.org/en/downloads/">download Ruby</a>.</p>

<p>We also need a library called <a href="http://watir.com/">watir</a>.
If you&rsquo;re lucky, typing &ldquo;gem install watir&rdquo; at your terminal will get you it.</p>

<h2>Watir</h2>

<p>Let&rsquo;s follow <a href="http://watir.com/examples/">the example</a>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">require</span> <span class="s1">&#39;watir&#39;</span> 

<span class="nx">browser</span> <span class="o">=</span> <span class="nx">Watir</span><span class="o">::</span><span class="nx">Browser</span><span class="p">.</span><span class="k">new</span> <span class="o">:</span><span class="nx">chrome</span>
<span class="nx">browser</span><span class="p">.</span><span class="kr">goto</span> <span class="s1">&#39;http://bit.ly/watir-example&#39;</span>

<span class="nx">browser</span><span class="p">.</span><span class="nx">text_field</span><span class="p">(</span><span class="o">:</span><span class="nx">name</span> <span class="o">=&gt;</span> <span class="s1">&#39;entry.1000000&#39;</span><span class="p">).</span><span class="nx">set</span> <span class="s1">&#39;Amanda&#39;</span>

<span class="nx">browser</span><span class="p">.</span><span class="nx">text_field</span><span class="p">(</span><span class="o">:</span><span class="nx">name</span> <span class="o">=&gt;</span> <span class="s1">&#39;entry.1000001&#39;</span><span class="p">).</span><span class="nx">set</span> <span class="s2">&quot;I come here from Australia. \n The weather is great here.&quot;</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">radio</span><span class="p">(</span><span class="o">:</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Watir&#39;</span><span class="p">).</span><span class="nx">set</span>

<span class="nx">browser</span><span class="p">.</span><span class="nx">checkbox</span><span class="p">(</span><span class="o">:</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">).</span><span class="nx">set</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">checkbox</span><span class="p">(</span><span class="o">:</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Python&#39;</span><span class="p">).</span><span class="nx">set</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">checkbox</span><span class="p">(</span><span class="o">:</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Python&#39;</span><span class="p">).</span><span class="nx">clear</span>

<span class="nx">browser</span><span class="p">.</span><span class="nx">select_list</span><span class="p">(</span><span class="o">:</span><span class="nx">name</span> <span class="o">=&gt;</span> <span class="s1">&#39;entry.1000004&#39;</span><span class="p">).</span><span class="nx">select</span> <span class="s1">&#39;Chrome&#39;</span>

<span class="err">#</span> <span class="nx">your</span> <span class="nx">exercise</span><span class="o">:</span> <span class="nx">figure</span> <span class="nx">out</span> <span class="nx">how</span> <span class="nx">to</span> <span class="nx">click</span> <span class="nx">a</span> <span class="nx">button</span> <span class="nx">about</span> <span class="nx">how</span> <span class="nx">happy</span> <span class="nx">you</span> <span class="nx">are</span><span class="p">.</span>

<span class="nx">browser</span><span class="p">.</span><span class="nx">button</span><span class="p">(</span><span class="o">:</span><span class="nx">name</span> <span class="o">=&gt;</span> <span class="s1">&#39;submit&#39;</span><span class="p">).</span><span class="nx">click</span>

<span class="nx">puts</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">include</span><span class="o">?</span> <span class="s1">&#39;Your response has been recorded.&#39;</span>
<span class="nx">puts</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">title</span> <span class="o">==</span> <span class="s1">&#39;Thanks!&#39;</span>

<span class="nx">browser</span><span class="p">.</span><span class="nx">close</span>
</code></pre></div>
<p>The <code>this</code> is frankly a little abstract.</p>

<h3>Doing math on strings</h3>

<p>Data types are always annoying – numbers and words and dates are different to your browser, and we need to knwo what we&rsquo;re working with. In your console, type</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="s2">&quot;3000&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">);</span>
</code></pre></div>
<p>This is a problem that has been <a href="https://www.google.com/search?q=javascript+turning+a+string+into+a+number&amp;oq=javascript+turning+a+string+into+a+number&amp;aqs=chrome..69i57j69i65l2j0l2j69i60.5205j0j7&amp;sourceid=chrome&amp;es_sm=119&amp;ie=UTF-8">Googled before</a>.</p>

<h3>Having and updating variables</h3>

<p>To have a calculator of any kind, you need to be able to keep track of a few numbers. Variables can help!</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>

<span class="c1">//I start with zero.</span>
<span class="kd">var</span> <span class="nx">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.dose&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>


  <span class="c1">//how much is in the dose I jut clicked (number, please, not string)?</span>
  <span class="kd">var</span> <span class="nx">thisDose</span> <span class="o">=</span> <span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;dosage&quot;</span><span class="p">);</span>

  <span class="c1">//my total is equal to the previous total plus what I just clicked</span>
  <span class="nx">total</span> <span class="o">=</span> <span class="nx">thisDose</span> <span class="o">+</span> <span class="nx">total</span><span class="p">;</span>

<span class="p">});</span>

<span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<h3>Selection and de-selection</h3>

<p>Any button you want to click, you want to be able to un-click. That&rsquo;s an issue of <em>state</em> and of <em>presentation</em> – recognizing the state your button is in and displaying it to reflect that state.</p>

<p>An easy to do this is by adding a CSS class to the div when it is selected. </p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>

  <span class="c">/* this applies to all .dose divs*/</span>
  <span class="nc">.dose</span> <span class="p">{</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#f0f0f0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c">/* this applies to divs classed dose AND selected-dose */</span>
  <span class="nc">.dose.selected-dose</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
  <span class="p">}</span>

<span class="nt">&lt;/style&gt;</span>
</code></pre></div>
<h3>Detecting classes</h3>

<p>Of course, you need to know whether something is selected when you&rsquo;re doing math – are you adding to the total or subtracting from it? Here&rsquo;s what Googling &ldquo;Detecting classes in jQuery&rdquo; <a href="https://www.google.com/search?q=detecting+classes+in+jquery&amp;oq=detecting+classes+in+jquery&amp;aqs=chrome..69i57.3390j0j7&amp;sourceid=chrome&amp;es_sm=119&amp;ie=UTF-8">got me</a>. The <code>hasClass</code> function in particular seems helpful. Here are <a href="https://api.jquery.com/hasclass/">the docs</a> for that.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>

<span class="c1">//I start with zero.</span>
<span class="kd">var</span> <span class="nx">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.dose&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="c1">//how much is in the dose I jut clicked (number, please, not string)?</span>
  <span class="kd">var</span> <span class="nx">thisDose</span> <span class="o">=</span> <span class="o">+</span><span class="nx">button</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;dosage&quot;</span><span class="p">);</span>

  <span class="c1">// is this already selected?</span>
  <span class="kd">var</span> <span class="nx">isAlreadySelected</span> <span class="o">=</span> <span class="nx">button</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;selected-dose&quot;</span><span class="p">);</span>

  <span class="c1">//if so, unselect it and remove its dosage from my total.</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isAlreadySelected</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;selected-dose&quot;</span><span class="p">);</span>
    <span class="nx">total</span> <span class="o">=</span> <span class="nx">total</span> <span class="o">-</span> <span class="nx">thisDose</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">//if not, select it and add its dosage from my total.</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isAlreadySelected</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;selected-dose&quot;</span><span class="p">);</span>
    <span class="nx">total</span> <span class="o">=</span> <span class="nx">total</span> <span class="o">+</span> <span class="nx">thisDose</span><span class="p">;</span>
  <span class="p">}</span>



<span class="p">});</span>

<span class="o">&lt;</span><span class="err">/script&gt;</span>
</code></pre></div>
<h3>Writing stuff on a page</h3>

<p>It&rsquo;s cool to see stuff show up on the page based on code you wrote. Here, an empty div with the class <code>current-total-dose-display</code> gets filled with the word &ldquo;Moo&rdquo;:</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;current-total-dose-display&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
  <span class="c1">//you can probably adopt this to your app easily.</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.current-total-dose-display&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Moo&quot;</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<h3>Putting it all together</h3>

<p>Here&rsquo;s a <a href="demo.html">basic demo</a> of all these concepts.</p>

</div>


        </div> <!-- /main -->

        <script src="/assets/base.js" charset="utf-8"></script>

    </body>
</html>
